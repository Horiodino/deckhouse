image: {{ .ModuleName }}/{{ .ImageName }}
from: {{ .Images.BASE_NGINX_ALPINE }}
docker:
  EXPOSE: '8080'
import:
- artifact: application-assets
  add: /app/dist
  after: install
git:
- add: /modules/810-ui/images/frontend/nginx.conf
  to: /etc/nginx/nginx.conf

---
artifact: application-assets
from: {{ .Images.BASE_NODE_16_ALPINE }}
ansible:
  install:
  - name: 'Install dependencies'
    shell: |
      set -e
      cd /app
      npm ci --ignore-scripts
    args:
      executable: /bin/bash
  setup:
  - name: "Build assets"
    shell: |
      set -e
      export NODE_ENV=production
      cd /app

      npm run build-only
    args:
      executable: /bin/bash
git:
# was /
- add: /modules/810-ui/images/frontend
  to: /app
  # owner: app
  # group: app
  excludePaths:
  - public/mockServiceWorker.js
  - vendor
  - node_modules
  stageDependencies:
    install:
    - package-lock.json
    setup:
    - src/*

image: {{ .ModuleName }}/{{ .ImageName }}
from: {{ .Images.BASE_ALPINE }}
docker:
  ENV:
    WORKDIR: /
    ENTRYPOINT: "/machine-controller-manager"
import:
- artifact: {{ .ModuleName }}/{{ .ImageName }}/build
  add: /src/bin/machine-controller-manager
  to: /machine-controller-manager
  before: setup
---
artifact: {{ .ModuleName }}/{{ .ImageName }}/build
from: {{ .Images.BASE_GOLANG_ALPINE }}
fromCacheVersion: "20210607"
git:
- url: https://github.com/deckhouse/mcm.git
  to: /src
  commit: 3561e5243d8daa7d1525a080331b469244347424
  stageDependencies:
    install:
    - '**/*'
mount:
- fromPath: ~/go-pkg-cache
  to: /go/pkg
ansible:
  beforeInstall:
  - name: "Install dependencies"
    apk:
      name:
      - mercurial
      - make
      - bash
      - tzdata
      update_cache: yes
  install:
  - name: "Build"
    shell: make build-local
    args:
      chdir: /src
